<?xml version="1.0"?>
<!--
  Copyright 2003-2004 
  frederic.glorieux@ajlsm.com

2004-04-27
An ant driver for different tasks
For now, do nothing.

Should compile some classes


= REFERENCES =
http://home.earthlink.net/~russelllear/WebSvcs.html


-->
<project basedir="." default="test" name="xfolio">
  <taskdef resource="net/sf/antcontrib/antlib.xml"/>
  <!-- the webfolder property properties for this build -->
  <property name="src" location="../docs"/>
  <!-- a delelable work folder where to store enough for caching -->
  <property name="build" location="${src}-work"/>
  <!-- the target website folder -->
  <property name="dist" location="${src}-website"/>
  <!-- 

dev target.

-->
  <target name="test" depends="build, dist"/>
  <!-- 

build target.

-->
  <target name="build">
    <echo>src=${src}</echo>
    <echo>build=${build}</echo>
    <!-- copy sxw files in work -->
    <copy todir="${build}">
      <fileset dir="${src}" includes="**/*.sxw"/>
    </copy>
    <foreach target="OOoWriter" param="file">
      <fileset dir="${build}" includes="**/*.sxw"/>
    </foreach>
  </target>
  <!-- 

sxw files, do job "foreach" in build

-->
  <target name="OOoWriter">
    <unzip src="${file}" dest="${file}!"/>
    <!-- aggregate OO doc -->
    <xslt in="${file}!/content.xml" out="${file}.OOo" style="transform/OOo/sxw2sxw.xsl">
      <xmlcatalog>
        <dtd publicId="-//OpenOffice.org//DTD OfficeDocument 1.0//EN" location="schema/dummy.dtd"/>
      </xmlcatalog>
      <param name="meta.xml" expression="meta.xml"/>
      <param name="styles.xml" expression="styles.xml"/>
    </xslt>
    <!-- extract meta for an RDF -->
    <xslt in="${file}.OOo" out="${file}.rdf" style="transform/OOo/sxw2rdf.xsl"/>
    <!-- a quite nice text version -->
    <xslt in="${file}.OOo" out="${file}.txt" style="transform/OOo/sxw2txt.xsl"/>
    <!-- an clean xhtml without navigation -->
    <xslt in="${file}.OOo" out="${file}.xhtml" style="transform/OOo/sxw2html.xsl">
      <param name="path" expression="${file}"/>
    </xslt>
    <!-- flatten pictures -->
    <copy todir="${file}!">
      <fileset dir="${file}!/Pictures"/>
    </copy>
  </target>
  <!-- 

copy/rename from build to dist

-->
  <target name="dist" depends="build">
        <mkdir dir="${dist}"/>
    <echo>dist=${dist}</echo>

    <!-- copy src to dist -->
    <copy todir="${dist}">
      <fileset dir="${src}">
        <exclude name="**/Thumbs.db"/>
      </fileset>
    </copy>
    <!-- rdf - copy-rename from build to dist -->
    <copy todir="${dist}">
      <fileset dir="${build}" >
        <include name="**/*.sxw.rdf"/>
      </fileset>
      <mapper type="glob" from="*.sxw.rdf" to="*.rdf"/>
    </copy>
    <!-- txt - copy-rename txt files -->
    <copy todir="${dist}">
      <fileset dir="${build}" >
        <include name="**/*.sxw.txt"/>
      </fileset>
      <mapper type="glob" from="*.sxw.txt" to="*.txt"/>
    </copy>
    <!-- images - copy and rename -->
    <copy todir="${dist}">
      <fileset dir="${build}" >
        <exclude name="**/*.xml"/>
        <include name="**/*.sxw!/*.*"/>
      </fileset>
      <mapper type="regexp" from="^(.*).sxw!(.*)$" to="\1\2"/>    
    </copy>
    <!-- copy all sources -->
    <copy todir="${dist}">
      <fileset dir="${build}" >
        <include name="**/*.sxw.xhtml"/>
      </fileset>
      <mapper type="glob" from="*.sxw.xhtml" to="*.xhtml"/>
    </copy>
  
  </target>
</project>
